<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查询页面</title>
    <link rel="stylesheet" href="__PUBLIC__/css/bootstrap.min.css">
    <link rel="stylesheet" href="__PUBLIC__/css/bootstrap-datetimepicker.min.css">
    <script type="text/javascript" src="__PUBLIC__/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/moment-with-locales.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/bootstrapValidator.min.js"></script>
</head>
<body>
<div class="container">
    <div class="row">
        <form class="form-inline" role="form" id="myForm" method="post">
            <div class="form-group">
                <label class="" for="username">姓名:</label>
                <input type="text" class="form-control" id="username" name="username" placeholder="名字">
            </div>
            <div class="form-group">
                <label class="" for="username">日期:</label>
                <a class='input-group date' id='datetimepicker1'>
                    <input type='text' class="form-control" id='nowdate1' name="start"/>
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                </a>-
                <a class='input-group date' id='datetimepicker2'>
                    <input type='text' class="form-control" id='nowdate2' name="end"/>
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                </a>
            </div>
            <button type="button" id="btnSearch" class="btn btn-success">查询</button>
        </form>
    </div>
</div>
<hr/><br/>
</body>
<script type="text/javascript">
        //校验插件 start
        $("#myForm").bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                //验证名字不能为空
                username: {
                    message: '名称验证失败',
                    validators: {
                        notEmpty: {
                            message: '名称不能为空'
                        },
                        //可以在callback里面写上自定义的一些校验规则
                        // callback: {
                        //     message: '自定义的校验失败',
                        //     callback: function(value, validator) {
                        //         if (value=="") {
                        //             return false;
                        //         } else {
                        //             return true;
                        //         }
                        //     }
                        // }
                    }
                },

                //验证时间
                start: {
                    validators: {
                        // integer: {},
                        callback: {
                            message: '开始日期不能大于结束日期',
                            callback:function(value, validator,$field,options){
                                var strtime1 = $("#nowdate1").val();
                                var strtime2 = $('#nowdate2').val();
                                var start = new Date(strtime1.replace(/-/g, '/'));
                                var end = new Date(strtime2.replace(/-/g, '/'));
                                // alert(start);
                                // alert(end);
                                // alert((strtime1<strtime2));
                                // alert(parseInt(start));
                                // alert(parseInt(end));
                                // alert(start.getTime()/1000);
                                // alert(end.getTime()/1000);
                                return parseInt(start.getTime()/1000)<=parseInt(end.getTime()/1000);
                            }
                        }
                    }
                }

            },
        });

        $("#btnSearch").on("click",function(){
            //定义一个校验器
            var bootstrapValidator = $("#myForm").data('bootstrapValidator');
            //执行校验
            bootstrapValidator.validate();
            //判断校验结果
            if(bootstrapValidator.isValid()){
                //校验成功,可以ajax提交表单到服务器
                // var status="";                     //得到radio的值
                // if($("#status1").is(":checked")){
                //     status=$("#status1").val();
                // }else if($("#status2").is(":checked")){
                //     status=$("#status2").val();
                // }
                var username=$("#username").val().trim();  //得到名称的值
                var strtime1 = $("#nowdate1").val();
                var strtime2 = $('#nowdate2').val();
                var start = new Date(strtime1.replace(/-/g, '/'));
                var end = new Date(strtime2.replace(/-/g, '/'));
                $.ajax({
                    type:'post',
                    data:{
                        "username":username,
                        "start":start.getTime()/1000,
                        "end":end.getTime()/1000
                    },
                    dataType:'json',
                    url: "{:U('searchData')}",
                    success: function(data) {
                        if(data.code=="200"){
                            //提交成功
                        }else{
                            //提交失败
                        }
                    },
                    error:function(data){
                        //提交失败
                    }
                });
            }else{
                //校验失败
            }
        });

        //校验插件 end

        //日期插件 start
        $('#datetimepicker1').datetimepicker({
            language: 'zh-CN',//显示中文
            format: 'yyyy-mm-dd',//显示格式
            minView: "month",//设置只显示到月份
            initialDate: new Date(),
            autoclose: true,//选中自动关闭
            todayBtn: true,//显示今日按钮
            locale: moment.locale('zh-cn')
        });
        $('#datetimepicker2').datetimepicker({
            language: 'zh-CN',//显示中文
            format: 'yyyy-mm-dd',//显示格式
            minView: "month",//设置只显示到月份
            initialDate: new Date(),
            autoclose: true,//选中自动关闭
            todayBtn: true,//显示今日按钮
            locale: moment.locale('zh-cn')
        });
        //默认获取当前日期
        var today = new Date();
        var nowdate = (today.getFullYear()) + "-" + (today.getMonth() + 1) + "-" + today.getDate();
        //对日期格式进行处理
        var date = new Date(nowdate);
        var mon = date.getMonth() + 1;
        var day = date.getDate();
        var mydate = date.getFullYear() + "-" + (mon < 10 ? "0" + mon : mon) + "-" + (day < 10 ? "0" + day : day);
        document.getElementById("nowdate1").value = mydate;
        //日期插件 end
</script>
</html>